<!DOCTYPE html>
<html lang="pt-br">
<head>
    <!-- Manter todo o head existente -->
    <!-- Adicionar apenas os novos estilos específicos para a área de administração -->
<style>
/* ===== ESTILOS GERAIS PROFISSIONAIS ===== */
:root {
    --azul-escuro: #0a2463;
    --azul-medio: #3e92cc;
    --azul-claro: #d6eaff;
    --verde: #4caf50;
    --vermelho: #f44336;
    --cinza-escuro: #333;
    --cinza-medio: #757575;
    --cinza-claro: #f5f5f5;
    --branco: #ffffff;
    --branco-brilhante: rgba(255, 255, 255, 0.9);
    --verde-disponivel: #2ecc71;
    --azul-agendado: #3498db;
    --azul-selecionado: #1a5276;
    --fundo-cinza: #f0f0f0;
    --entregue: #d4edda;
    --nao-entregue: #f8d7da;
    --expirado: #fff3cd;
    --recente: #ffebee;
    --sombra: 0 4px 12px rgba(0, 0, 0, 0.1);
    --borda: 1px solid rgba(0, 0, 0, 0.1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background: linear-gradient(135deg, var(--azul-escuro) 0%, #1a365d 100%);
    color: var(--cinza-escuro);
    min-height: 100vh;
    padding: 20px;
    line-height: 1.6;
}

/* ===== CABEÇALHO E TÍTULOS ===== */
h2 {
    color: var(--branco);
    margin-bottom: 30px;
    text-align: center;
    text-transform: uppercase;
    font-weight: 600;
    letter-spacing: 1px;
    font-size: 1.8rem;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

h3 {
    color: var(--azul-escuro);
    margin: 1.5rem 0;
    text-align: center;
    text-transform: uppercase;
    font-size: 1.2rem;
    font-weight: 500;
    position: relative;
    padding-bottom: 10px;
}

h3::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 3px;
    background: var(--azul-medio);
    border-radius: 3px;
}

/* ===== CONTAINERS PRINCIPAIS ===== */
.container {
    display: flex;
    gap: 30px;
    flex-wrap: wrap;
    max-width: 1400px;
    margin: 0 auto;
}

.form-container, 
.calendar-container,
.admin-container {
    flex: 1;
    min-width: 300px;
    background-color: var(--branco-brilhante);
    padding: 25px;
    border-radius: 12px;
    box-shadow: var(--sombra);
    color: var(--cinza-escuro);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.form-container:hover,
.calendar-container:hover,
.admin-container:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
}

/* ===== FORMULÁRIOS ===== */
.form-row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 1.5rem;
}

.form-group {
    flex: 1;
    min-width: 220px;
    position: relative;
    margin-bottom: 1rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--azul-escuro);
    font-size: 0.9rem;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 12px 15px;
    border: var(--borda);
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background-color: var(--branco);
    color: var(--cinza-escuro);
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    border-color: var(--azul-medio);
    box-shadow: 0 0 0 3px rgba(62, 146, 204, 0.2);
    outline: none;
}

/* ===== BOTÕES ===== */
.buttons-container {
    display: flex;
    gap: 10px;
    margin-top: 25px;
    flex-wrap: wrap;
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    box-shadow: var(--sombra);
    position: relative;
    overflow: hidden;
    font-size: 0.9rem;
    letter-spacing: 0.5px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.btn:active {
    transform: translateY(2px);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.btn-cadastrar {
    background-color: var(--azul-medio);
    color: white;
}

.btn-cadastrar:hover {
    background-color: #2c7ebd;
}

.btn-limpar {
    background-color: #f0f0f0;
    color: #333;
}

.btn-limpar:hover {
    background-color: #e0e0e0;
}

.btn-excluir {
    background-color: var(--vermelho);
    color: white;
}

.btn-excluir:hover {
    background-color: #d32f2f;
}

.btn-entregar {
    background-color: var(--verde);
    color: white;
}

.btn-entregar:hover {
    background-color: #3d8b40;
}

/* ===== TABELAS ===== */
.calendar,
.historico-table,
.equipment-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin-top: 20px;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: var(--sombra);
}

.calendar th,
.calendar td,
.historico-table th,
.historico-table td,
.equipment-table th,
.equipment-table td {
    padding: 12px 15px;
    text-align: center;
    border: var(--borda);
}

.calendar th,
.historico-table th,
.equipment-table th {
    background-color: var(--azul-escuro);
    color: white;
    font-weight: 500;
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
}

.calendar td {
    background-color: var(--branco);
    transition: all 0.2s;
}

.historico-table td,
.equipment-table td {
    color: var(--cinza-escuro);
    font-size: 0.9rem;
}

.historico-table tr.excluido td {
    color: var(--vermelho);
}

.historico-table tr.entregue {
    background-color: var(--entregue);
}

.historico-table tr.nao-entregue {
    background-color: var(--nao-entregue);
}

.historico-table tr.expirado {
    background-color: var(--expirado);
}

.historico-table tr.recente {
    background-color: var(--recente);
}

/* ===== ÁREA ADMINISTRATIVA ===== */
.admin-tabs {
    display: flex;
    margin-bottom: 25px;
    border-bottom: 2px solid var(--azul-claro);
}

.admin-tab {
    padding: 12px 24px;
    cursor: pointer;
    background-color: var(--azul-claro);
    margin-right: 5px;
    border-radius: 8px 8px 0 0;
    font-weight: 500;
    color: var(--azul-escuro);
    transition: all 0.3s;
}

.admin-tab:hover {
    background-color: rgba(62, 146, 204, 0.2);
}

.admin-tab.active {
    background-color: var(--azul-medio);
    color: white;
}

.search-container {
    margin-bottom: 25px;
    display: flex;
    gap: 15px;
}

.search-container input {
    flex: 1;
    padding: 12px 15px;
    border: var(--borda);
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s;
}

.search-container input:focus {
    border-color: var(--azul-medio);
    box-shadow: 0 0 0 3px rgba(62, 146, 204, 0.2);
}

.filter-container {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

.filter-container select {
    padding: 10px 15px;
    border: var(--borda);
    border-radius: 8px;
    font-size: 0.9rem;
    min-width: 180px;
}

.equipment-form {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 25px;
}

.equipment-form .form-group {
    margin-bottom: 0;
}

.full-width {
    grid-column: 1 / -1;
}

/* ===== STATUS ===== */
.status-disponivel {
    background-color: var(--verde-disponivel);
    color: white;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
    display: inline-block;
}

.status-emuso {
    background-color: var(--azul-agendado);
    color: white;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
    display: inline-block;
}

.status-manutencao {
    background-color: var(--vermelho);
    color: white;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
    display: inline-block;
}

.status-indisponivel {
    background-color: var(--cinza-medio);
    color: white;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
    display: inline-block;
}

/* ===== MODAIS ===== */
.modal {
    display: none;
    position: fixed;
    z-index: 1001;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
}

.modal-content {
    background-color: #fefefe;
    margin: 10% auto;
    padding: 25px;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    animation: modalFadeIn 0.3s;
}

@keyframes modalFadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s;
}

.close:hover {
    color: black;
}

/* ===== RESPONSIVIDADE ===== */
@media (max-width: 768px) {
    .container {
        flex-direction: column;
    }
    
    .form-row {
        flex-direction: column;
        gap: 15px;
    }
    
    .buttons-container {
        flex-direction: column;
    }
    
    .btn {
        width: 100%;
    }
    
    .admin-tabs {
        flex-wrap: wrap;
    }
    
    .admin-tab {
        margin-bottom: 5px;
    }
    
    .search-container {
        flex-direction: column;
    }
}

/* ===== ANIMAÇÕES ===== */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.fade-in {
    animation: fadeIn 0.5s ease-in-out;
}

/* ===== MELHORIAS ESPECÍFICAS ===== */
/* Tooltip para ícones */
[data-tooltip] {
    position: relative;
    cursor: pointer;
}

[data-tooltip]:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--azul-escuro);
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 0.8rem;
    white-space: nowrap;
    z-index: 100;
}

/* Barra de rolagem personalizada */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--cinza-claro);
}

::-webkit-scrollbar-thumb {
    background: var(--azul-medio);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--azul-escuro);
}

/* Efeito de hover em linhas da tabela */
.historico-table tr:not(:first-child):hover,
.equipment-table tr:not(:first-child):hover {
    background-color: rgba(62, 146, 204, 0.1);
    transition: background-color 0.2s;
}

/* Ícones nos botões */
.btn i {
    font-size: 1rem;
}

/* Cards de resumo */
.summary-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: var(--sombra);
    margin-bottom: 20px;
    text-align: center;
}

.summary-card h4 {
    color: var(--azul-escuro);
    margin-bottom: 10px;
    font-size: 1rem;
}

.summary-card .value {
    font-size: 2rem;
    font-weight: 600;
    color: var(--azul-medio);
}

/* Formulário de login */
.login-container {
    max-width: 400px;
    margin: 50px auto;
    background-color: var(--branco-brilhante);
    padding: 30px;
    border-radius: 12px;
    box-shadow: var(--sombra);
    animation: fadeIn 0.5s;
}

.login-container h3 {
    color: var(--azul-escuro);
    text-align: center;
    margin-bottom: 25px;
    font-size: 1.5rem;
}

.login-container .form-group {
    margin-bottom: 20px;
}

.login-container label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--azul-escuro);
    font-size: 0.9rem;
}

.login-container input {
    width: 100%;
    padding: 12px 15px;
    border: var(--borda);
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.3s;
}

.login-container input:focus {
    border-color: var(--azul-medio);
    box-shadow: 0 0 0 3px rgba(62, 146, 204, 0.2);
}

.login-container .btn {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
}

/* Mensagens de feedback */
.alert {
    padding: 12px 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.alert-success {
    background-color: var(--entregue);
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-error {
    background-color: var(--nao-entregue);
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.alert-warning {
    background-color: var(--expirado);
    color: #856404;
    border: 1px solid #ffeeba;
}

/* Badges */
.badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-primary {
    background-color: var(--azul-medio);
    color: white;
}

.badge-success {
    background-color: var(--verde);
    color: white;
}

.badge-danger {
    background-color: var(--vermelho);
    color: white;
}

.badge-warning {
    background-color: #ffc107;
    color: #212529;
}

/* Layout em grid para cards */
.grid-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

/* Efeito de loading */
.loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255,255,255,.3);
    border-radius: 50%;
    border-top-color: var(--branco);
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}
</style>
</head>
<body>
    <!-- Manter todo o conteúdo existente -->
    <!-- Adicionar o botão para acessar a área administrativa -->
    <div style="text-align: right; margin-bottom: 10px;">
        <button class="btn btn-cadastrar" onclick="toggleAdminArea()">ÁREA ADMINISTRATIVA</button>
    </div>

    <!-- Área de login administrativo (inicialmente visível) -->
    <div id="adminLogin" class="login-container">
        <h3>ACESSO ADMINISTRATIVO</h3>
        <div class="form-group">
            <label for="adminEmail">E-mail Institucional:</label>
            <input type="email" id="adminEmail" placeholder="@prof.educacao.sp.gov.br">
        </div>
        <div class="form-group">
            <label for="adminPassword">Senha:</label>
            <input type="password" id="adminPassword">
        </div>
        <button class="btn btn-cadastrar" onclick="loginAdmin()">ACESSAR</button>
    </div>

    <!-- Área administrativa (inicialmente oculta) -->
    <div id="adminArea" class="admin-container">
        <div class="admin-tabs">
            <div class="admin-tab active" onclick="openAdminTab('equipment-management')">Gerenciar Equipamentos</div>
            <div class="admin-tab" onclick="openAdminTab('maintenance')">Manutenção/Garantia</div>
            <div class="admin-tab" onclick="openAdminTab('reports')">Relatórios</div>
        </div>

        <!-- Gerenciamento de Equipamentos -->
        <div id="equipment-management" class="admin-content active">
            <h3>CADASTRO DE EQUIPAMENTOS</h3>
            
            <div class="search-container">
                <input type="text" id="equipmentSearch" placeholder="Pesquisar equipamentos..." onkeyup="searchEquipment()">
                <button class="btn btn-cadastrar" onclick="showAddEquipmentForm()">+ Novo Equipamento</button>
            </div>

            <div class="filter-container">
                <select id="filterCategory" onchange="filterEquipment()">
                    <option value="">Todas as categorias</option>
                    <option value="Notebook do aluno">Notebook do aluno</option>
                    <option value="Notebook ADM">Notebook ADM</option>
                    <option value="Chromebooks">Chromebooks</option>
                    <option value="Smartphone">Smartphone</option>
                    <option value="Tablets">Tablets</option>
                    <option value="Datashow">Datashow</option>
                    <option value="Desktop Lenovo">Desktop Lenovo</option>
                    <option value="Red Set">Red Set</option>
                    <option value="Caixas de som">Caixas de som</option>
                    <option value="Microfones">Microfones</option>
                    <option value="Notebook Ultra">Notebook Ultra</option>
                    <option value="Plataforma de Carregamento">Plataforma de Carregamento</option>
                    <option value="TVs">TVs</option>
                </select>

                <select id="filterLocation" onchange="filterEquipment()">
                    <option value="">Todos os locais</option>
                    <option value="Sala dos professores">Sala dos professores</option>
                    <option value="Sala de informática">Sala de informática</option>
                    <option value="Depósito 1ª andar">Depósito 1ª andar</option>
                    <option value="Coordenação">Coordenação</option>
                    <option value="Vice Direção">Vice Direção</option>
                    <option value="Secretaria">Secretaria</option>
                    <option value="Direção">Direção</option>
                    <option value="Anfiteatro">Anfiteatro</option>
                    <option value="Sala de aula">Sala de aula</option>
                </select>

                <select id="filterStatus" onchange="filterEquipment()">
                    <option value="">Todos os status</option>
                    <option value="Disponível">Disponível</option>
                    <option value="Em uso">Em uso</option>
                    <option value="Manutenção">Manutenção</option>
                    <option value="Indisponível">Indisponível</option>
                </select>
            </div>

            <div id="addEquipmentForm" style="display: none;">
                <div class="equipment-form">
                    <div class="form-group">
                        <label>Patrimônio:</label>
                        <input type="text" id="equipmentId">
                    </div>
                    <div class="form-group">
                        <label>Categoria:</label>
                        <select id="equipmentCategory">
                            <option value="Notebook do aluno">Notebook do aluno</option>
                            <option value="Notebook ADM">Notebook ADM</option>
                            <option value="Chromebooks">Chromebooks</option>
                            <option value="Smartphone">Smartphone</option>
                            <option value="Tablets">Tablets</option>
                            <option value="Datashow">Datashow</option>
                            <option value="Desktop Lenovo">Desktop Lenovo</option>
                            <option value="Red Set">Red Set</option>
                            <option value="Caixas de som">Caixas de som</option>
                            <option value="Microfones">Microfones</option>
                            <option value="Notebook Ultra">Notebook Ultra</option>
                            <option value="Plataforma de Carregamento">Plataforma de Carregamento</option>
                            <option value="TVs">TVs</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Marca:</label>
                        <input type="text" id="equipmentBrand">
                    </div>
                    <div class="form-group">
                        <label>Modelo:</label>
                        <input type="text" id="equipmentModel">
                    </div>
                    <div class="form-group">
                        <label>Localização:</label>
                        <select id="equipmentLocation">
                            <option value="Sala dos professores">Sala dos professores</option>
                            <option value="Sala de informática">Sala de informática</option>
                            <option value="Depósito 1ª andar">Depósito 1ª andar</option>
                            <option value="Coordenação">Coordenação</option>
                            <option value="Vice Direção">Vice Direção</option>
                            <option value="Secretaria">Secretaria</option>
                            <option value="Direção">Direção</option>
                            <option value="Anfiteatro">Anfiteatro</option>
                            <option value="Sala de aula">Sala de aula</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status:</label>
                        <select id="equipmentStatus">
                            <option value="Disponível">Disponível</option>
                            <option value="Em uso">Em uso</option>
                            <option value="Manutenção">Manutenção</option>
                            <option value="Indisponível">Indisponível</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label>Observações:</label>
                        <textarea id="equipmentNotes" rows="3" style="width: 100%; padding: 10px; border: 2px solid var(--branco-brilhante); border-radius: 8px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Número de Série:</label>
                        <input type="text" id="equipmentSerial">
                    </div>
                    <div class="form-group">
                        <label>Data de Aquisição:</label>
                        <input type="date" id="equipmentPurchaseDate">
                    </div>
                    <div class="form-group">
                        <label>Garantia até:</label>
                        <input type="date" id="equipmentWarranty">
                    </div>
                    <div class="form-group full-width">
                        <div class="buttons-container">
                            <button class="btn btn-cadastrar" onclick="saveEquipment()">SALVAR</button>
                            <button class="btn btn-limpar" onclick="cancelAddEquipment()">CANCELAR</button>
                        </div>
                    </div>
                </div>
            </div>

            <table class="equipment-table" id="equipmentTable">
                <thead>
                    <tr>
                        <th>Patrimônio</th>
                        <th>Categoria</th>
                        <th>Marca/Modelo</th>
                        <th>Localização</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="equipmentList">
                    <!-- Equipamentos serão carregados via JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Manutenção e Garantia -->
        <div id="maintenance" class="admin-content">
            <h3>CONTROLE DE MANUTENÇÃO E GARANTIA</h3>
            
            <div class="filter-container">
                <select id="filterMaintenanceStatus" onchange="filterMaintenance()">
                    <option value="">Todos os status</option>
                    <option value="Na garantia">Na garantia</option>
                    <option value="Fora da garantia">Fora da garantia</option>
                    <option value="Em manutenção">Em manutenção</option>
                    <option value="Conserto concluído">Conserto concluído</option>
                </select>
                
                <select id="filterMaintenanceCategory" onchange="filterMaintenance()">
                    <option value="">Todas as categorias</option>
                    <option value="Notebook do aluno">Notebook do aluno</option>
                    <option value="Notebook ADM">Notebook ADM</option>
                    <option value="Chromebooks">Chromebooks</option>
                    <option value="Smartphone">Smartphone</option>
                    <option value="Tablets">Tablets</option>
                    <option value="Datashow">Datashow</option>
                    <option value="Desktop Lenovo">Desktop Lenovo</option>
                    <option value="Red Set">Red Set</option>
                    <option value="Caixas de som">Caixas de som</option>
                    <option value="Microfones">Microfones</option>
                    <option value="Notebook Ultra">Notebook Ultra</option>
                    <option value="Plataforma de Carregamento">Plataforma de Carregamento</option>
                    <option value="TVs">TVs</option>
                </select>
            </div>

            <table class="equipment-table" id="maintenanceTable">
                <thead>
                    <tr>
                        <th>Patrimônio</th>
                        <th>Equipamento</th>
                        <th>Problema</th>
                        <th>Data Reportado</th>
                        <th>Status Garantia</th>
                        <th>Fabricante</th>
                        <th>Previsão</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="maintenanceList">
                    <!-- Registros de manutenção serão carregados via JavaScript -->
                </tbody>
            </table>

            <div class="equipment-details" id="maintenanceDetails" style="display: none;">
                <h4>REGISTRAR MANUTENÇÃO</h4>
                <div class="equipment-form">
                    <div class="form-group">
                        <label>Equipamento:</label>
                        <input type="text" id="maintenanceEquipment" readonly>
                    </div>
                    <div class="form-group">
                        <label>Problema:</label>
                        <select id="maintenanceProblem">
                            <option value="Hardware">Problema de Hardware</option>
                            <option value="Software">Problema de Software</option>
                            <option value="Elétrico">Problema Elétrico</option>
                            <option value="Físico">Danos Físicos</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Descrição detalhada:</label>
                        <textarea id="maintenanceDescription" rows="3" style="width: 100%; padding: 10px; border: 2px solid var(--branco-brilhante); border-radius: 8px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Status da Garantia:</label>
                        <select id="maintenanceWarrantyStatus">
                            <option value="Na garantia">Na garantia</option>
                            <option value="Fora da garantia">Fora da garantia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fabricante/Fornecedor:</label>
                        <input type="text" id="maintenanceVendor">
                    </div>
                    <div class="form-group">
                        <label>Contato do Fornecedor:</label>
                        <input type="text" id="maintenanceVendorContact">
                    </div>
                    <div class="form-group">
                        <label>Data de envio:</label>
                        <input type="date" id="maintenanceSendDate">
                    </div>
                    <div class="form-group">
                        <label>Previsão de retorno:</label>
                        <input type="date" id="maintenanceReturnDate">
                    </div>
                    <div class="form-group full-width">
                        <div class="buttons-container">
                            <button class="btn btn-cadastrar" onclick="saveMaintenance()">REGISTRAR</button>
                            <button class="btn btn-limpar" onclick="cancelMaintenance()">CANCELAR</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Relatórios -->
        <div id="reports" class="admin-content">
            <h3>RELATÓRIOS DE EQUIPAMENTOS</h3>
            
            <div class="filter-container">
                <select id="reportType" onchange="updateReportFilters()">
                    <option value="inventory">Inventário Geral</option>
                    <option value="status">Status dos Equipamentos</option>
                    <option value="maintenance">Histórico de Manutenções</option>
                    <option value="warranty">Equipamentos na Garantia</option>
                    <option value="movement">Movimentação de Equipamentos</option>
                </select>
                
                <select id="reportCategory" onchange="generateReport()">
                    <option value="">Todas as categorias</option>
                    <option value="Notebook do aluno">Notebook do aluno</option>
                    <option value="Notebook ADM">Notebook ADM</option>
                    <option value="Chromebooks">Chromebooks</option>
                    <option value="Smartphone">Smartphone</option>
                    <option value="Tablets">Tablets</option>
                    <option value="Datashow">Datashow</option>
                    <option value="Desktop Lenovo">Desktop Lenovo</option>
                    <option value="Red Set">Red Set</option>
                    <option value="Caixas de som">Caixas de som</option>
                    <option value="Microfones">Microfones</option>
                    <option value="Notebook Ultra">Notebook Ultra</option>
                    <option value="Plataforma de Carregamento">Plataforma de Carregamento</option>
                    <option value="TVs">TVs</option>
                </select>
                
                <select id="reportPeriod" onchange="generateReport()">
                    <option value="all">Todo o período</option>
                    <option value="month">Este mês</option>
                    <option value="quarter">Este trimestre</option>
                    <option value="year">Este ano</option>
                    <option value="custom">Personalizado</option>
                </select>
                
                <div id="customDateRange" style="display: none;">
                    <input type="date" id="reportStartDate">
                    <input type="date" id="reportEndDate">
                </div>
            </div>
            
            <div class="buttons-container" style="margin-bottom: 20px;">
                <button class="btn btn-cadastrar" onclick="generateReport()">GERAR RELATÓRIO</button>
                <button class="btn btn-cadastrar" onclick="exportReportToPDF()">EXPORTAR PDF</button>
                <button class="btn btn-cadastrar" onclick="exportReportToCSV()">EXPORTAR CSV</button>
            </div>
            
            <div id="reportResults">
                <!-- Resultados do relatório serão exibidos aqui -->
                <p>Selecione os filtros e clique em "Gerar Relatório" para visualizar os dados.</p>
            </div>
        </div>
    </div>

    <script>
        // Constantes para armazenamento local
        const EQUIPMENT_STORAGE_KEY = 'equipamentos_escola';
        const MAINTENANCE_STORAGE_KEY = 'manutencoes_equipamentos';
        
        // Carrega equipamentos do localStorage ou inicializa vazio
        let equipamentos = JSON.parse(localStorage.getItem(EQUIPMENT_STORAGE_KEY)) || [];
        let manutencoes = JSON.parse(localStorage.getItem(MAINTENANCE_STORAGE_KEY)) || [];
        
        // Variáveis para controle da interface
        let selectedEquipment = null;
        let selectedMaintenance = null;
        let isAdminLoggedIn = false;
        
        // Função para salvar equipamentos no localStorage
        function salvarEquipamentos() {
            localStorage.setItem(EQUIPMENT_STORAGE_KEY, JSON.stringify(equipamentos));
            localStorage.setItem(MAINTENANCE_STORAGE_KEY, JSON.stringify(manutencoes));
        }
        
        // Função para alternar a área administrativa
        function toggleAdminArea() {
            if (!isAdminLoggedIn) {
                document.getElementById('adminLogin').style.display = 'block';
                document.getElementById('adminArea').style.display = 'none';
            } else {
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminArea').style.display = 'block';
                loadEquipmentList();
                loadMaintenanceList();
            }
        }
        
        // Função de login administrativo
        function loginAdmin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            if (email.endsWith('@prof.educacao.sp.gov.br') && password === 'Proati@Lydia') {
                isAdminLoggedIn = true;
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminArea').style.display = 'block';
                loadEquipmentList();
                loadMaintenanceList();
            } else {
                alert('Credenciais inválidas. Apenas e-mails institucionais e a senha correta podem acessar esta área.');
            }
        }
        
        // Função para abrir abas administrativas
        function openAdminTab(tabName) {
            // Esconde todos os conteúdos
            const contents = document.getElementsByClassName('admin-content');
            for (let i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            
            // Remove a classe active de todas as abas
            const tabs = document.getElementsByClassName('admin-tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Mostra o conteúdo da aba selecionada e marca a aba como ativa
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
            
            // Carrega os dados específicos da aba se necessário
            if (tabName === 'equipment-management') {
                loadEquipmentList();
            } else if (tabName === 'maintenance') {
                loadMaintenanceList();
            } else if (tabName === 'reports') {
                generateReport();
            }
        }
        
        // Função para carregar a lista de equipamentos
        function loadEquipmentList() {
            const equipmentList = document.getElementById('equipmentList');
            equipmentList.innerHTML = '';
            
            equipamentos.forEach(equipamento => {
                const row = document.createElement('tr');
                
                // Determina a classe de status
                let statusClass = '';
                let statusText = '';
                switch(equipamento.status) {
                    case 'Disponível':
                        statusClass = 'status-disponivel';
                        statusText = 'Disponível';
                        break;
                    case 'Em uso':
                        statusClass = 'status-emuso';
                        statusText = 'Em uso';
                        break;
                    case 'Manutenção':
                        statusClass = 'status-manutencao';
                        statusText = 'Manutenção';
                        break;
                    case 'Indisponível':
                        statusClass = 'status-indisponivel';
                        statusText = 'Indisponível';
                        break;
                }
                
                row.innerHTML = `
                    <td>${equipamento.patrimonio}</td>
                    <td>${equipamento.categoria}</td>
                    <td>${equipamento.marca} ${equipamento.modelo}</td>
                    <td>${equipamento.localizacao}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-cadastrar" onclick="editEquipment('${equipamento.patrimonio}')">Editar</button>
                        <button class="btn btn-excluir" onclick="deleteEquipment('${equipamento.patrimonio}')">Excluir</button>
                        ${equipamento.status !== 'Manutenção' ? 
                          `<button class="btn btn-limpar" onclick="reportMaintenance('${equipamento.patrimonio}')">Manutenção</button>` : 
                          `<button class="btn btn-entregar" onclick="completeMaintenance('${equipamento.patrimonio}')">Concluir</button>`}
                    </td>
                `;
                
                equipmentList.appendChild(row);
            });
        }
        
        // Função para carregar a lista de manutenções
        function loadMaintenanceList() {
            const maintenanceList = document.getElementById('maintenanceList');
            maintenanceList.innerHTML = '';
            
            manutencoes.forEach(manutencao => {
                const equipamento = equipamentos.find(e => e.patrimonio === manutencao.equipamentoId) || {};
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${manutencao.equipamentoId}</td>
                    <td>${equipamento.categoria || ''} ${equipamento.marca || ''} ${equipamento.modelo || ''}</td>
                    <td>${manutencao.problema}</td>
                    <td>${manutencao.dataReportado}</td>
                    <td>${manutencao.statusGarantia}</td>
                    <td>${manutencao.fabricante || ''}</td>
                    <td>${manutencao.previsaoRetorno || ''}</td>
                    <td>
                        <button class="btn btn-cadastrar" onclick="viewMaintenanceDetails('${manutencao.id}')">Detalhes</button>
                        ${manutencao.status !== 'Concluído' ? 
                          `<button class="btn btn-entregar" onclick="completeMaintenance('${manutencao.equipamentoId}')">Concluir</button>` : ''}
                    </td>
                `;
                
                maintenanceList.appendChild(row);
            });
        }
        
        // Função para filtrar equipamentos
        function filterEquipment() {
            const category = document.getElementById('filterCategory').value;
            const location = document.getElementById('filterLocation').value;
            const status = document.getElementById('filterStatus').value;
            
            const filtered = equipamentos.filter(equipamento => {
                return (!category || equipamento.categoria === category) &&
                       (!location || equipamento.localizacao === location) &&
                       (!status || equipamento.status === status);
            });
            
            const equipmentList = document.getElementById('equipmentList');
            equipmentList.innerHTML = '';
            
            filtered.forEach(equipamento => {
                const row = document.createElement('tr');
                
                let statusClass = '';
                let statusText = '';
                switch(equipamento.status) {
                    case 'Disponível':
                        statusClass = 'status-disponivel';
                        statusText = 'Disponível';
                        break;
                    case 'Em uso':
                        statusClass = 'status-emuso';
                        statusText = 'Em uso';
                        break;
                    case 'Manutenção':
                        statusClass = 'status-manutencao';
                        statusText = 'Manutenção';
                        break;
                    case 'Indisponível':
                        statusClass = 'status-indisponivel';
                        statusText = 'Indisponível';
                        break;
                }
                
                row.innerHTML = `
                    <td>${equipamento.patrimonio}</td>
                    <td>${equipamento.categoria}</td>
                    <td>${equipamento.marca} ${equipamento.modelo}</td>
                    <td>${equipamento.localizacao}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-cadastrar" onclick="editEquipment('${equipamento.patrimonio}')">Editar</button>
                        <button class="btn btn-excluir" onclick="deleteEquipment('${equipamento.patrimonio}')">Excluir</button>
                        ${equipamento.status !== 'Manutenção' ? 
                          `<button class="btn btn-limpar" onclick="reportMaintenance('${equipamento.patrimonio}')">Manutenção</button>` : 
                          `<button class="btn btn-entregar" onclick="completeMaintenance('${equipamento.patrimonio}')">Concluir</button>`}
                    </td>
                `;
                
                equipmentList.appendChild(row);
            });
        }
        
        // Função para filtrar manutenções
        function filterMaintenance() {
            const status = document.getElementById('filterMaintenanceStatus').value;
            const category = document.getElementById('filterMaintenanceCategory').value;
            
            const filtered = manutencoes.filter(manutencao => {
                const equipamento = equipamentos.find(e => e.patrimonio === manutencao.equipamentoId) || {};
                return (!status || manutencao.statusGarantia === status || 
                       (status === 'Em manutenção' && manutencao.status === 'Em andamento') ||
                       (status === 'Conserto concluído' && manutencao.status === 'Concluído')) &&
                       (!category || equipamento.categoria === category);
            });
            
            const maintenanceList = document.getElementById('maintenanceList');
            maintenanceList.innerHTML = '';
            
            filtered.forEach(manutencao => {
                const equipamento = equipamentos.find(e => e.patrimonio === manutencao.equipamentoId) || {};
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${manutencao.equipamentoId}</td>
                    <td>${equipamento.categoria || ''} ${equipamento.marca || ''} ${equipamento.modelo || ''}</td>
                    <td>${manutencao.problema}</td>
                    <td>${manutencao.dataReportado}</td>
                    <td>${manutencao.statusGarantia}</td>
                    <td>${manutencao.fabricante || ''}</td>
                    <td>${manutencao.previsaoRetorno || ''}</td>
                    <td>
                        <button class="btn btn-cadastrar" onclick="viewMaintenanceDetails('${manutencao.id}')">Detalhes</button>
                        ${manutencao.status !== 'Concluído' ? 
                          `<button class="btn btn-entregar" onclick="completeMaintenance('${manutencao.equipamentoId}')">Concluir</button>` : ''}
                    </td>
                `;
                
                maintenanceList.appendChild(row);
            });
        }
        
        // Função para pesquisar equipamentos
        function searchEquipment() {
            const searchTerm = document.getElementById('equipmentSearch').value.toLowerCase();
            
            const filtered = equipamentos.filter(equipamento => {
                return equipamento.patrimonio.toLowerCase().includes(searchTerm) ||
                       equipamento.categoria.toLowerCase().includes(searchTerm) ||
                       equipamento.marca.toLowerCase().includes(searchTerm) ||
                       equipamento.modelo.toLowerCase().includes(searchTerm) ||
                       equipamento.localizacao.toLowerCase().includes(searchTerm) ||
                       equipamento.status.toLowerCase().includes(searchTerm);
            });
            
            const equipmentList = document.getElementById('equipmentList');
            equipmentList.innerHTML = '';
            
            filtered.forEach(equipamento => {
                const row = document.createElement('tr');
                
                let statusClass = '';
                let statusText = '';
                switch(equipamento.status) {
                    case 'Disponível':
                        statusClass = 'status-disponivel';
                        statusText = 'Disponível';
                        break;
                    case 'Em uso':
                        statusClass = 'status-emuso';
                        statusText = 'Em uso';
                        break;
                    case 'Manutenção':
                        statusClass = 'status-manutencao';
                        statusText = 'Manutenção';
                        break;
                    case 'Indisponível':
                        statusClass = 'status-indisponivel';
                        statusText = 'Indisponível';
                        break;
                }
                
                row.innerHTML = `
                    <td>${equipamento.patrimonio}</td>
                    <td>${equipamento.categoria}</td>
                    <td>${equipamento.marca} ${equipamento.modelo}</td>
                    <td>${equipamento.localizacao}</td>
                    <td><span class="${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-cadastrar" onclick="editEquipment('${equipamento.patrimonio}')">Editar</button>
                        <button class="btn btn-excluir" onclick="deleteEquipment('${equipamento.patrimonio}')">Excluir</button>
                        ${equipamento.status !== 'Manutenção' ? 
                          `<button class="btn btn-limpar" onclick="reportMaintenance('${equipamento.patrimonio}')">Manutenção</button>` : 
                          `<button class="btn btn-entregar" onclick="completeMaintenance('${equipamento.patrimonio}')">Concluir</button>`}
                    </td>
                `;
                
                equipmentList.appendChild(row);
            });
        }
        
        // Função para mostrar o formulário de adição de equipamento
        function showAddEquipmentForm() {
            document.getElementById('addEquipmentForm').style.display = 'block';
            document.getElementById('equipmentId').value = '';
            document.getElementById('equipmentCategory').value = 'Notebook do aluno';
            document.getElementById('equipmentBrand').value = '';
            document.getElementById('equipmentModel').value = '';
            document.getElementById('equipmentLocation').value = 'Sala de informática';
            document.getElementById('equipmentStatus').value = 'Disponível';
            document.getElementById('equipmentNotes').value = '';
            document.getElementById('equipmentSerial').value = '';
            document.getElementById('equipmentPurchaseDate').value = '';
            document.getElementById('equipmentWarranty').value = '';
            
            selectedEquipment = null;
        }
        
        // Função para editar um equipamento
        function editEquipment(patrimonio) {
            const equipamento = equipamentos.find(e => e.patrimonio === patrimonio);
            if (!equipamento) return;
            
            document.getElementById('addEquipmentForm').style.display = 'block';
            document.getElementById('equipmentId').value = equipamento.patrimonio;
            document.getElementById('equipmentCategory').value = equipamento.categoria;
            document.getElementById('equipmentBrand').value = equipamento.marca;
            document.getElementById('equipmentModel').value = equipamento.modelo;
            document.getElementById('equipmentLocation').value = equipamento.localizacao;
            document.getElementById('equipmentStatus').value = equipamento.status;
            document.getElementById('equipmentNotes').value = equipamento.observacoes || '';
            document.getElementById('equipmentSerial').value = equipamento.numeroSerie || '';
            document.getElementById('equipmentPurchaseDate').value = equipamento.dataAquisicao || '';
            document.getElementById('equipmentWarranty').value = equipamento.garantia || '';
            
            selectedEquipment = equipamento;
        }
        
        // Função para salvar um equipamento (novo ou existente)
        function saveEquipment() {
            const patrimonio = document.getElementById('equipmentId').value;
            const categoria = document.getElementById('equipmentCategory').value;
            const marca = document.getElementById('equipmentBrand').value;
            const modelo = document.getElementById('equipmentModel').value;
            const localizacao = document.getElementById('equipmentLocation').value;
            const status = document.getElementById('equipmentStatus').value;
            const observacoes = document.getElementById('equipmentNotes').value;
            const numeroSerie = document.getElementById('equipmentSerial').value;
            const dataAquisicao = document.getElementById('equipmentPurchaseDate').value;
            const garantia = document.getElementById('equipmentWarranty').value;
            
            if (!patrimonio || !categoria || !marca || !modelo || !localizacao || !status) {
                alert('Preencha todos os campos obrigatórios!');
                return;
            }
            
            if (selectedEquipment) {
                // Atualiza equipamento existente
                selectedEquipment.patrimonio = patrimonio;
                selectedEquipment.categoria = categoria;
                selectedEquipment.marca = marca;
                selectedEquipment.modelo = modelo;
                selectedEquipment.localizacao = localizacao;
                selectedEquipment.status = status;
                selectedEquipment.observacoes = observacoes;
                selectedEquipment.numeroSerie = numeroSerie;
                selectedEquipment.dataAquisicao = dataAquisicao;
                selectedEquipment.garantia = garantia;
            } else {
                // Adiciona novo equipamento
                const novoEquipamento = {
                    patrimonio,
                    categoria,
                    marca,
                    modelo,
                    localizacao,
                    status,
                    observacoes,
                    numeroSerie,
                    dataAquisicao,
                    garantia
                };
                
                equipamentos.push(novoEquipamento);
            }
            
            salvarEquipamentos();
            loadEquipmentList();
            cancelAddEquipment();
            
            alert('Equipamento salvo com sucesso!');
        }
        
        // Função para cancelar a adição/edição de equipamento
        function cancelAddEquipment() {
            document.getElementById('addEquipmentForm').style.display = 'none';
            selectedEquipment = null;
        }
        
        // Função para excluir um equipamento
        function deleteEquipment(patrimonio) {
            if (!confirm('Tem certeza que deseja excluir este equipamento?')) return;
            
            equipamentos = equipamentos.filter(e => e.patrimonio !== patrimonio);
            salvarEquipamentos();
            loadEquipmentList();
            
            alert('Equipamento excluído com sucesso!');
        }
        
        // Função para reportar manutenção de um equipamento
        function reportMaintenance(patrimonio) {
            const equipamento = equipamentos.find(e => e.patrimonio === patrimonio);
            if (!equipamento) return;
            
            document.getElementById('maintenanceDetails').style.display = 'block';
            document.getElementById('maintenanceEquipment').value = `${equipamento.patrimonio} - ${equipamento.categoria} ${equipamento.marca} ${equipamento.modelo}`;
            document.getElementById('maintenanceProblem').value = 'Hardware';
            document.getElementById('maintenanceDescription').value = '';
            document.getElementById('maintenanceWarrantyStatus').value = equipamento.garantia && new Date(equipamento.garantia) > new Date() ? 'Na garantia' : 'Fora da garantia';
            document.getElementById('maintenanceVendor').value = equipamento.marca || '';
            document.getElementById('maintenanceVendorContact').value = '';
            document.getElementById('maintenanceSendDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('maintenanceReturnDate').value = '';
            
            selectedEquipment = equipamento;
            selectedMaintenance = null;
        }
        
        // Função para visualizar detalhes de uma manutenção
        function viewMaintenanceDetails(maintenanceId) {
            const manutencao = manutencoes.find(m => m.id === maintenanceId);
            if (!manutencao) return;
            
            const equipamento = equipamentos.find(e => e.patrimonio === manutencao.equipamentoId) || {};
            
            document.getElementById('maintenanceDetails').style.display = 'block';
            document.getElementById('maintenanceEquipment').value = `${manutencao.equipamentoId} - ${equipamento.categoria || ''} ${equipamento.marca || ''} ${equipamento.modelo || ''}`;
            document.getElementById('maintenanceProblem').value = manutencao.problema;
            document.getElementById('maintenanceDescription').value = manutencao.descricao || '';
            document.getElementById('maintenanceWarrantyStatus').value = manutencao.statusGarantia;
            document.getElementById('maintenanceVendor').value = manutencao.fabricante || '';
            document.getElementById('maintenanceVendorContact').value = manutencao.contatoFornecedor || '';
            document.getElementById('maintenanceSendDate').value = manutencao.dataEnvio || '';
            document.getElementById('maintenanceReturnDate').value = manutencao.previsaoRetorno || '';
            
            selectedMaintenance = manutencao;
        }
        
        // Função para salvar uma manutenção
        function saveMaintenance() {
            if (!selectedEquipment) return;
            
            const problema = document.getElementById('maintenanceProblem').value;
            const descricao = document.getElementById('maintenanceDescription').value;
            const statusGarantia = document.getElementById('maintenanceWarrantyStatus').value;
            const fabricante = document.getElementById('maintenanceVendor').value;
            const contatoFornecedor = document.getElementById('maintenanceVendorContact').value;
            const dataEnvio = document.getElementById('maintenanceSendDate').value;
            const previsaoRetorno = document.getElementById('maintenanceReturnDate').value;
            
            if (!problema) {
                alert('Informe o tipo de problema!');
                return;
            }
            
            if (selectedMaintenance) {
                // Atualiza manutenção existente
                selectedMaintenance.problema = problema;
                selectedMaintenance.descricao = descricao;
                selectedMaintenance.statusGarantia = statusGarantia;
                selectedMaintenance.fabricante = fabricante;
                selectedMaintenance.contatoFornecedor = contatoFornecedor;
                selectedMaintenance.dataEnvio = dataEnvio;
                selectedMaintenance.previsaoRetorno = previsaoRetorno;
            } else {
                // Adiciona nova manutenção
                const novaManutencao = {
                    id: Date.now().toString(),
                    equipamentoId: selectedEquipment.patrimonio,
                    problema,
                    descricao,
                    statusGarantia,
                    fabricante,
                    contatoFornecedor,
                    dataReportado: new Date().toLocaleDateString(),
                    dataEnvio,
                    previsaoRetorno,
                    status: 'Em andamento'
                };
                
                manutencoes.push(novaManutencao);
                
                // Atualiza status do equipamento
                const equipamento = equipamentos.find(e => e.patrimonio === selectedEquipment.patrimonio);
                if (equipamento) {
                    equipamento.status = 'Manutenção';
                }
            }
            
            salvarEquipamentos();
            loadEquipmentList();
            loadMaintenanceList();
            cancelMaintenance();
            
            alert('Manutenção registrada com sucesso!');
        }
        
        // Função para concluir uma manutenção
        function completeMaintenance(patrimonio) {
            const manutencao = manutencoes.find(m => m.equipamentoId === patrimonio && m.status === 'Em andamento');
            if (manutencao) {
                manutencao.status = 'Concluído';
                manutencao.dataConclusao = new Date().toLocaleDateString();
            }
            
            const equipamento = equipamentos.find(e => e.patrimonio === patrimonio);
            if (equipamento) {
                equipamento.status = 'Disponível';
            }
            
            salvarEquipamentos();
            loadEquipmentList();
            loadMaintenanceList();
            
            alert('Manutenção concluída e equipamento marcado como disponível!');
        }
        
        // Função para cancelar o registro de manutenção
        function cancelMaintenance() {
            document.getElementById('maintenanceDetails').style.display = 'none';
            selectedMaintenance = null;
        }
        
        // Função para atualizar os filtros do relatório
        function updateReportFilters() {
            const reportType = document.getElementById('reportType').value;
            const customDateRange = document.getElementById('customDateRange');
            
            if (reportType === 'custom') {
                customDateRange.style.display = 'block';
            } else {
                customDateRange.style.display = 'none';
            }
        }
        
        // Função para gerar relatório
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const category = document.getElementById('reportCategory').value;
            const period = document.getElementById('reportPeriod').value;
            
            let reportData = [];
            let reportTitle = '';
            
            switch(reportType) {
                case 'inventory':
                    reportTitle = 'Inventário Geral de Equipamentos';
                    reportData = equipamentos.filter(e => !category || e.categoria === category);
                    break;
                    
                case 'status':
                    reportTitle = 'Status dos Equipamentos';
                    reportData = equipamentos.filter(e => !category || e.categoria === category);
                    break;
                    
                case 'maintenance':
                    reportTitle = 'Histórico de Manutenções';
                    reportData = manutencoes.filter(m => {
                        const equipamento = equipamentos.find(e => e.patrimonio === m.equipamentoId) || {};
                        return (!category || equipamento.categoria === category);
                    });
                    break;
                    
                case 'warranty':
                    reportTitle = 'Equipamentos na Garantia';
                    reportData = equipamentos.filter(e => {
                        return (!category || e.categoria === category) && 
                               e.garantia && new Date(e.garantia) > new Date();
                    });
                    break;
                    
                case 'movement':
                    reportTitle = 'Movimentação de Equipamentos';
                    // Implementar lógica de movimentação se necessário
                    break;
            }
            
            // Aplicar filtro de período se necessário
            if (period !== 'all' && reportType !== 'inventory') {
                const now = new Date();
                let startDate, endDate;
                
                switch(period) {
                    case 'month':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                        break;
                        
                    case 'quarter':
                        const quarter = Math.floor(now.getMonth() / 3);
                        startDate = new Date(now.getFullYear(), quarter * 3, 1);
                        endDate = new Date(now.getFullYear(), quarter * 3 + 3, 0);
                        break;
                        
                    case 'year':
                        startDate = new Date(now.getFullYear(), 0, 1);
                        endDate = new Date(now.getFullYear(), 11, 31);
                        break;
                        
                    case 'custom':
                        startDate = new Date(document.getElementById('reportStartDate').value);
                        endDate = new Date(document.getElementById('reportEndDate').value);
                        break;
                }
                
                if (reportType === 'maintenance') {
                    reportData = reportData.filter(m => {
                        const reportDate = m.dataReportado ? new Date(m.dataReportado) : null;
                        return reportDate && reportDate >= startDate && reportDate <= endDate;
                    });
                } else if (reportType === 'warranty') {
                    reportData = reportData.filter(e => {
                        const warrantyDate = e.garantia ? new Date(e.garantia) : null;
                        return warrantyDate && warrantyDate >= startDate && warrantyDate <= endDate;
                    });
                }
            }
            
            // Exibir resultados
            const reportResults = document.getElementById('reportResults');
            
            if (reportData.length === 0) {
                reportResults.innerHTML = `<p>Nenhum dado encontrado para os filtros selecionados.</p>`;
                return;
            }
            
            let html = `<h4>${reportTitle}</h4>`;
            
            if (reportType === 'inventory' || reportType === 'status' || reportType === 'warranty') {
                html += `
                    <table class="equipment-table">
                        <thead>
                            <tr>
                                <th>Patrimônio</th>
                                <th>Categoria</th>
                                <th>Marca/Modelo</th>
                                <th>Localização</th>
                                <th>Status</th>
                                ${reportType === 'warranty' ? '<th>Garantia até</th>' : ''}
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                reportData.forEach(item => {
                    let statusClass = '';
                    let statusText = '';
                    switch(item.status) {
                        case 'Disponível':
                            statusClass = 'status-disponivel';
                            statusText = 'Disponível';
                            break;
                        case 'Em uso':
                            statusClass = 'status-emuso';
                            statusText = 'Em uso';
                            break;
                        case 'Manutenção':
                            statusClass = 'status-manutencao';
                            statusText = 'Manutenção';
                            break;
                        case 'Indisponível':
                            statusClass = 'status-indisponivel';
                            statusText = 'Indisponível';
                            break;
                    }
                    
                    html += `
                        <tr>
                            <td>${item.patrimonio}</td>
                            <td>${item.categoria}</td>
                            <td>${item.marca} ${item.modelo}</td>
                            <td>${item.localizacao}</td>
                            <td><span class="${statusClass}">${statusText}</span></td>
                            ${reportType === 'warranty' ? `<td>${item.garantia || 'N/A'}</td>` : ''}
                        </tr>
                    `;
                });
                
                html += `</tbody></table>`;
            } else if (reportType === 'maintenance') {
                html += `
                    <table class="equipment-table">
                        <thead>
                            <tr>
                                <th>Equipamento</th>
                                <th>Problema</th>
                                <th>Data Reportado</th>
                                <th>Status Garantia</th>
                                <th>Fabricante</th>
                                <th>Previsão</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                reportData.forEach(item => {
                    const equipamento = equipamentos.find(e => e.patrimonio === item.equipamentoId) || {};
                    
                    html += `
                        <tr>
                            <td>${equipamento.categoria || ''} ${equipamento.marca || ''} ${equipamento.modelo || ''}</td>
                            <td>${item.problema}</td>
                            <td>${item.dataReportado}</td>
                            <td>${item.statusGarantia}</td>
                            <td>${item.fabricante || ''}</td>
                            <td>${item.previsaoRetorno || ''}</td>
                            <td>${item.status}</td>
                        </tr>
                    `;
                });
                
                html += `</tbody></table>`;
            }
            
            reportResults.innerHTML = html;
        }
        
        // Função para exportar relatório para PDF
        function exportReportToPDF() {
            const reportType = document.getElementById('reportType').value;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Cabeçalho
            doc.setFontSize(18);
            doc.setTextColor(10, 36, 99);
            doc.text("RELATÓRIO DE EQUIPAMENTOS", 105, 20, null, null, 'center');
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text("ESCOLA ESTADUAL - NOME DA ESCOLA", 105, 30, null, null, 'center');
            
            const reportTitle = document.getElementById('reportType').options[document.getElementById('reportType').selectedIndex].text;
            doc.text(`Tipo: ${reportTitle}`, 105, 36, null, null, 'center');
            
            const category = document.getElementById('reportCategory').value;
            if (category) {
                doc.text(`Categoria: ${category}`, 105, 42, null, null, 'center');
            }
            
            // Linha divisória
            doc.setDrawColor(10, 36, 99);
            doc.setLineWidth(0.5);
            doc.line(20, 48, 190, 48);
            
            // Dados do relatório
            let headers = [];
            let data = [];
            
            switch(reportType) {
                case 'inventory':
                    headers = ["Patrimônio", "Categoria", "Marca/Modelo", "Localização", "Status"];
                    
                    equipamentos.forEach(item => {
                        if (!category || item.categoria === category) {
                            data.push([
                                item.patrimonio,
                                item.categoria,
                                `${item.marca} ${item.modelo}`,
                                item.localizacao,
                                item.status
                            ]);
                        }
                    });
                    break;
                    
                case 'status':
                    headers = ["Patrimônio", "Categoria", "Marca/Modelo", "Localização", "Status"];
                    
                    equipamentos.forEach(item => {
                        if (!category || item.categoria === category) {
                            data.push([
                                item.patrimonio,
                                item.categoria,
                                `${item.marca} ${item.modelo}`,
                                item.localizacao,
                                item.status
                            ]);
                        }
                    });
                    break;
                    
                case 'maintenance':
                    headers = ["Equipamento", "Problema", "Data Reportado", "Status Garantia", "Fabricante", "Previsão", "Status"];
                    
                    manutencoes.forEach(item => {
                        const equipamento = equipamentos.find(e => e.patrimonio === item.equipamentoId) || {};
                        if (!category || equipamento.categoria === category) {
                            data.push([
                                `${equipamento.categoria || ''} ${equipamento.marca || ''} ${equipamento.modelo || ''}`,
                                item.problema,
                                item.dataReportado,
                                item.statusGarantia,
                                item.fabricante || '',
                                item.previsaoRetorno || '',
                                item.status
                            ]);
                        }
                    });
                    break;
                    
                case 'warranty':
                    headers = ["Patrimônio", "Categoria", "Marca/Modelo", "Localização", "Status", "Garantia até"];
                    
                    equipamentos.forEach(item => {
                        if ((!category || item.categoria === category) && item.garantia && new Date(item.garantia) > new Date()) {
                            data.push([
                                item.patrimonio,
                                item.categoria,
                                `${item.marca} ${item.modelo}`,
                                item.localizacao,
                                item.status,
                                item.garantia
                            ]);
                        }
                    });
                    break;
            }
            
            if (data.length === 0) {
                doc.setFontSize(12);
                doc.text("Nenhum dado encontrado para os filtros selecionados.", 105, 60, null, null, 'center');
            } else {
                doc.autoTable({
                    head: [headers],
                    body: data,
                    startY: 55,
                    theme: 'grid',
                    headStyles: {
                        fillColor: [10, 36, 99],
                        textColor: 255,
                        fontStyle: 'bold'
                    },
                    alternateRowStyles: {
                        fillColor: [240, 240, 240]
                    }
                });
            }
            
            // Data e hora de geração
            const agora = new Date();
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100);
            doc.text(`Relatório gerado em: ${agora.toLocaleString()}`, 105, 285, null, null, 'center');
            
            // Salva o PDF
            const nomeArquivo = `Relatorio_${reportTitle.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(nomeArquivo);
        }
        
        // Função para exportar relatório para CSV
        function exportReportToCSV() {
            const reportType = document.getElementById('reportType').value;
            const category = document.getElementById('reportCategory').value;
            
            let csv = '';
            let headers = [];
            let data = [];
            
            switch(reportType) {
                case 'inventory':
                    headers = ["Patrimônio", "Categoria", "Marca", "Modelo", "Localização", "Status", "Número de Série", "Data de Aquisição", "Garantia até", "Observações"];
                    
                    equipamentos.forEach(item => {
                        if (!category || item.categoria === category) {
                            data.push([
                                `"${item.patrimonio}"`,
                                `"${item.categoria}"`,
                                `"${item.marca}"`,
                                `"${item.modelo}"`,
                                `"${item.localizacao}"`,
                                `"${item.status}"`,
                                `"${item.numeroSerie || ''}"`,
                                `"${item.dataAquisicao || ''}"`,
                                `"${item.garantia || ''}"`,
                                `"${item.observacoes || ''}"`
                            ]);
                        }
                    });
                    break;
                    
                case 'status':
                    headers = ["Patrimônio", "Categoria", "Marca", "Modelo", "Localização", "Status"];
                    
                    equipamentos.forEach(item => {
                        if (!category || item.categoria === category) {
                            data.push([
                                `"${item.patrimonio}"`,
                                `"${item.categoria}"`,
                                `"${item.marca}"`,
                                `"${item.modelo}"`,
                                `"${item.localizacao}"`,
                                `"${item.status}"`
                            ]);
                        }
                    });
                    break;
                    
                case 'maintenance':
                    headers = ["Equipamento", "Patrimônio", "Problema", "Descrição", "Data Reportado", "Status Garantia", "Fabricante", "Contato Fornecedor", "Data Envio", "Previsão Retorno", "Status"];
                    
                    manutencoes.forEach(item => {
                        const equipamento = equipamentos.find(e => e.patrimonio === item.equipamentoId) || {};
                        if (!category || equipamento.categoria === category) {
                            data.push([
                                `"${equipamento.categoria || ''} ${equipamento.marca || ''} ${equipamento.modelo || ''}"`,
                                `"${item.equipamentoId}"`,
                                `"${item.problema}"`,
                                `"${item.descricao || ''}"`,
                                `"${item.dataReportado}"`,
                                `"${item.statusGarantia}"`,
                                `"${item.fabricante || ''}"`,
                                `"${item.contatoFornecedor || ''}"`,
                                `"${item.dataEnvio || ''}"`,
                                `"${item.previsaoRetorno || ''}"`,
                                `"${item.status}"`
                            ]);
                        }
                    });
                    break;
                    
                case 'warranty':
                    headers = ["Patrimônio", "Categoria", "Marca", "Modelo", "Localização", "Status", "Garantia até"];
                    
                    equipamentos.forEach(item => {
                        if ((!category || item.categoria === category) && item.garantia && new Date(item.garantia) > new Date()) {
                            data.push([
                                `"${item.patrimonio}"`,
                                `"${item.categoria}"`,
                                `"${item.marca}"`,
                                `"${item.modelo}"`,
                                `"${item.localizacao}"`,
                                `"${item.status}"`,
                                `"${item.garantia}"`
                            ]);
                        }
                    });
                    break;
            }
            
            if (data.length === 0) {
                alert("Nenhum dado encontrado para os filtros selecionados.");
                return;
            }
            
            // Monta o CSV
            csv += headers.join(',') + '\n';
            data.forEach(row => {
                csv += row.join(',') + '\n';
            });
            
            // Cria o arquivo CSV
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            
            const reportTitle = document.getElementById('reportType').options[document.getElementById('reportType').selectedIndex].text;
            link.setAttribute('download', `Relatorio_${reportTitle.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`);
            
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Integração com o sistema de agendamento
        function atualizarDisponibilidadeEquipamentos() {
            // Esta função deve ser chamada sempre que um equipamento for emprestado ou devolvido
            // Atualiza a contagem de equipamentos disponíveis para agendamento
            
            // Conta equipamentos disponíveis por categoria
            const disponibilidade = {
                'TABLET': 0,
                'SMARTPHONE': 0,
                'CHROMEBOOK': 0,
                'NOTEBOOK': 0
            };
            
            equipamentos.forEach(equipamento => {
                if (equipamento.status === 'Disponível') {
                    if (equipamento.categoria === 'Tablets') disponibilidade['TABLET']++;
                    else if (equipamento.categoria === 'Smartphone') disponibilidade['SMARTPHONE']++;
                    else if (equipamento.categoria === 'Chromebooks') disponibilidade['CHROMEBOOK']++;
                    else if (equipamento.categoria === 'Notebook do aluno' || equipamento.categoria === 'Notebook ADM' || equipamento.categoria === 'Notebook Ultra') disponibilidade['NOTEBOOK']++;
                }
            });
            
            // Atualiza as marcas disponíveis no sistema de agendamento
            marcas['TABLET'] = disponibilidade['TABLET'] > 0 ? 'POSITIVO' : 'INDISPONÍVEL';
            marcas['SMARTPHONE'] = disponibilidade['SMARTPHONE'] > 0 ? 'POSITIVO' : 'INDISPONÍVEL';
            marcas['CHROMEBOOK'] = disponibilidade['CHROMEBOOK'] > 0 ? 'SAMSUNG' : 'INDISPONÍVEL';
            marcas['NOTEBOOK'] = disponibilidade['NOTEBOOK'] > 0 ? 'POSITIVO' : 'INDISPONÍVEL';
            
            // Desabilita opções de equipamentos indisponíveis
            const selectAparelho = document.getElementById('aparelho');
            if (selectAparelho) {
                Array.from(selectAparelho.options).forEach(option => {
                    if (option.value && disponibilidade[option.value] <= 0) {
                        option.disabled = true;
                        option.textContent += ' (Indisponível)';
                    }
                });
            }
        }
        
        // Função para registrar empréstimo de equipamentos (chamada quando um agendamento é feito)
        function registrarEmprestimo(aparelho, quantidade) {
            let contador = 0;
            
            // Encontra equipamentos disponíveis da categoria selecionada
            const categoria = 
                aparelho === 'TABLET' ? 'Tablets' :
                aparelho === 'SMARTPHONE' ? 'Smartphone' :
                aparelho === 'CHROMEBOOK' ? 'Chromebooks' :
                'Notebook do aluno'; // Assume notebook do aluno para agendamentos
            
            equipamentos.forEach(equipamento => {
                if (contador < quantidade && equipamento.status === 'Disponível' && equipamento.categoria === categoria) {
                    equipamento.status = 'Em uso';
                    contador++;
                }
            });
            
            salvarEquipamentos();
            atualizarDisponibilidadeEquipamentos();
            
            if (contador < quantidade) {
                console.warn(`Não há equipamentos suficientes disponíveis. Solicitados: ${quantidade}, Disponíveis: ${contador}`);
            }
        }
        
        // Função para registrar devolução de equipamentos (chamada quando um agendamento é marcado como entregue)
        function registrarDevolucao(aparelho, quantidade) {
            let contador = 0;
            
            // Encontra equipamentos em uso da categoria selecionada
            const categoria = 
                aparelho === 'TABLET' ? 'Tablets' :
                aparelho === 'SMARTPHONE' ? 'Smartphone' :
                aparelho === 'CHROMEBOOK' ? 'Chromebooks' :
                'Notebook do aluno'; // Assume notebook do aluno para agendamentos
            
            equipamentos.forEach(equipamento => {
                if (contador < quantidade && equipamento.status === 'Em uso' && equipamento.categoria === categoria) {
                    equipamento.status = 'Disponível';
                    contador++;
                }
            });
            
            salvarEquipamentos();
            atualizarDisponibilidadeEquipamentos();
            
            if (contador < quantidade) {
                console.warn(`Não foi possível registrar a devolução de todos os equipamentos. Esperados: ${quantidade}, Registrados: ${contador}`);
            }
        }
        
        // Modificação da função cadastrarAgendamento para integrar com o gerenciamento de equipamentos
        const originalCadastrarAgendamento = cadastrarAgendamento;
        cadastrarAgendamento = function() {
            const aparelho = document.getElementById("aparelho").value;
            const numAparelhos = parseInt(document.getElementById("numero-aparelhos").value);
            
            // Verifica disponibilidade antes de cadastrar
            const categoria = 
                aparelho === 'TABLET' ? 'Tablets' :
                aparelho === 'SMARTPHONE' ? 'Smartphone' :
                aparelho === 'CHROMEBOOK' ? 'Chromebooks' :
                'Notebook do aluno';
            
            const disponiveis = equipamentos.filter(e => 
                e.status === 'Disponível' && e.categoria === categoria
            ).length;
            
            if (disponiveis < numAparelhos) {
                alert(`Não há equipamentos suficientes disponíveis. Disponíveis: ${disponiveis}, Solicitados: ${numAparelhos}`);
                return;
            }
            
            // Chama a função original
            const result = originalCadastrarAgendamento.apply(this, arguments);
            
            // Se o agendamento foi bem-sucedido, registra o empréstimo
            if (result !== false) {
                registrarEmprestimo(aparelho, numAparelhos);
            }
        };
        
        // Modificação da função confirmarDevolucao para integrar com o gerenciamento de equipamentos
        const originalConfirmarDevolucao = confirmarDevolucao;
        confirmarDevolucao = function() {
            // Chama a função original
            const result = originalConfirmarDevolucao.apply(this, arguments);
            
            // Se a devolução foi bem-sucedida, registra a devolução
            if (result !== false && agendamentoParaDevolver) {
                registrarDevolucao(agendamentoParaDevolver.aparelho, agendamentoParaDevolver.numAparelhos);
            }
        };
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Carrega dados de equipamentos se já existirem
            if (localStorage.getItem(EQUIPMENT_STORAGE_KEY)) {
                equipamentos = JSON.parse(localStorage.getItem(EQUIPMENT_STORAGE_KEY));
            }
            
            if (localStorage.getItem(MAINTENANCE_STORAGE_KEY)) {
                manutencoes = JSON.parse(localStorage.getItem(MAINTENANCE_STORAGE_KEY));
            }
            
            // Atualiza disponibilidade de equipamentos para agendamento
            atualizarDisponibilidadeEquipamentos();
            
            // Configura a área administrativa como oculta inicialmente
            document.getElementById('adminArea').style.display = 'none';
            document.getElementById('adminLogin').style.display = 'block';
        });
    </script>
</body>
</html>